<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparison between did and didwrappers • didwrappers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison between did and didwrappers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">didwrappers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison_with_did.html">Comparison between did and didwrappers</a></li>
    <li><a class="dropdown-item" href="../articles/minimum-wage.html">Minimum wage example</a></li>
    <li><a class="dropdown-item" href="../articles/my-article.html">Democratization on growth</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ransiw/didwrappers/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparison between did and didwrappers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ransiw/didwrappers/blob/main/vignettes/comparison_with_did.Rmd" class="external-link"><code>vignettes/comparison_with_did.Rmd</code></a></small>
      <div class="d-none name"><code>comparison_with_did.Rmd</code></div>
    </div>

    
    
<p>This vignette compares the <code>did</code> and the current package
using the example data in the <code>did</code> package,
<code>mpdta</code>.</p>
<p>The example dataset that is used here contain county-level teen
employment (<code>lemp</code>) for years 2003-2007. The treatment is
minimum wage. The <code>first.treat</code> variable in the data encodes
the year the county raised minimum wage over the federally-mandated
level.</p>
<p>This vignette should be read along with the linked <a href="https://bcallaway11.github.io/did/" class="external-link">article</a> by Brantly
Callaway. I recreate the main results that were produced by the
<code>did</code> package, and then follow up with the comparable results
of <code>didwrappers</code>. The differences between the packages will
become clear soon.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ransiw/didwrappers" class="external-link">didwrappers</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcallaway11.github.io/did/" class="external-link">did</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span></code></pre></div>
<p>The first step in the <code>did</code> algorithm is to produce the
group-time component differences-in-differences estimates. I also time
the run times.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/att_gt.html" class="external-link">att_gt</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"reg"</span></span>
<span>              <span class="op">)</span></span>
<span><span class="va">endt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Time elapsed:"</span>,<span class="va">endt</span><span class="op">-</span><span class="va">startt</span>,<span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time elapsed: 0.286081552505493 seconds"</span></span></code></pre></div>
<p>The <code>didwrappers</code> package produces a similar object but at
the more granular unit-time level. This takes longer to run. The syntax
remains the same, only the function name should need to change.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"reg"</span></span>
<span>              <span class="op">)</span></span>
<span><span class="va">endt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Time elapsed:"</span>,<span class="va">endt</span><span class="op">-</span><span class="va">startt</span>,<span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time elapsed: 5.14096999168396 seconds"</span></span></code></pre></div>
<p>It takes quite a bit longer to do things at the county level than at
the group level, which is the year that minimum wage is raised. There
are certain advantages to having the more disaggregate county-level
object that <code>didwrappers:att_it</code> produces, particularly, if
aggregation across other attributes are needed.</p>
<p>The <code>didwrappers</code> package has a function to view this data
as a data frame. It is similar to <code>summary</code> functionality in
<code>did</code>, but handier if you wish to export the object as a
data-frame than a list. Here are the first 5 records of the table.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/attit_table.html">attit_table</a></span><span class="op">(</span><span class="va">out_it</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;      id group    t         att          se</span></span>
<span><span class="co">#&gt; 1 17005  2004 2004 -0.05585158 0.009800111</span></span>
<span><span class="co">#&gt; 2 17005  2004 2005 -0.20309028 0.010411691</span></span>
<span><span class="co">#&gt; 3 17005  2004 2006 -0.28130294 0.014637097</span></span>
<span><span class="co">#&gt; 4 17005  2004 2007 -0.20345574 0.014709711</span></span>
<span><span class="co">#&gt; 5 17015  2004 2004  0.05381939 0.009800111</span></span></code></pre></div>
<p>Now these can be aggregated at the group level, dynamic level,
calendar-time level. Starting with the object produced by the call to
the <code>did:att_gt</code> function, let’s take the group average.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_effects</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/aggte.html" class="external-link">aggte</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>didwrappers</code> package has a handy function to view
these as a data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">)</span></span>
<span><span class="co">#&gt;    egt     att.egt     se.egt     lci.egt      uci.egt</span></span>
<span><span class="co">#&gt; 1 2004 -0.07974913 0.02818050 -0.14181878 -0.017679476</span></span>
<span><span class="co">#&gt; 2 2006 -0.02290954 0.01620932 -0.05861176  0.012792684</span></span>
<span><span class="co">#&gt; 3 2007 -0.02605441 0.01616329 -0.06165526  0.009546442</span></span></code></pre></div>
<p>Now, to trying this with the unit-time object. The syntax is quite
similar, and these aggregation functions are not so computationally
expensive to run, even with a larger object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_effects_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">)</span></span>
<span><span class="co">#&gt;    egt     att.egt     se.egt     lci.egt       uci.egt</span></span>
<span><span class="co">#&gt; 1 2004 -0.07974913 0.01547871 -0.10858643 -0.0486014936</span></span>
<span><span class="co">#&gt; 2 2006 -0.02290954 0.01139708 -0.04590288 -0.0016980121</span></span>
<span><span class="co">#&gt; 3 2007 -0.02605441 0.01359484 -0.05213191 -0.0005395492</span></span></code></pre></div>
<p>The estimates produced by these packages are the same. The
differences are in the standard errors. The standard errors are smaller
under the latter which uses a bootstrap in the second stage. This isn’t
always the case, however.</p>
<p>One more aggregation method before the end of this vignette. Going
back to the group-time object,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/aggte.html" class="external-link">aggte</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"dynamic"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">es</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt       att.egt     se.egt     lci.egt      uci.egt</span></span>
<span><span class="co">#&gt; 1  -3  0.0305066556 0.01454718 -0.00779453  0.068807841</span></span>
<span><span class="co">#&gt; 2  -2 -0.0005630846 0.01313626 -0.03514947  0.034023305</span></span>
<span><span class="co">#&gt; 3  -1 -0.0244587450 0.01507024 -0.06413711  0.015219620</span></span>
<span><span class="co">#&gt; 4   0 -0.0199318168 0.01214935 -0.05191977  0.012056136</span></span>
<span><span class="co">#&gt; 5   1 -0.0509573671 0.01750455 -0.09704500 -0.004869734</span></span>
<span><span class="co">#&gt; 6   2 -0.1372587389 0.03765066 -0.23638895 -0.038128525</span></span>
<span><span class="co">#&gt; 7   3 -0.1008113631 0.03554112 -0.19438738 -0.007235349</span></span></code></pre></div>
<p>With the unit-time level algorithm,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type <span class="op">=</span> <span class="st">"dynamic"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt       att.egt     se.egt      lci.egt      uci.egt</span></span>
<span><span class="co">#&gt; 1  -3  0.0305066556 0.01181982  0.007118124  0.054019466</span></span>
<span><span class="co">#&gt; 2  -2 -0.0005630846 0.01179115 -0.023282833  0.022351324</span></span>
<span><span class="co">#&gt; 3  -1 -0.0244587450 0.01065796 -0.044614251 -0.003730810</span></span>
<span><span class="co">#&gt; 4   0 -0.0199318168 0.01035362 -0.039330343  0.001107409</span></span>
<span><span class="co">#&gt; 5   1 -0.0509573671 0.01476283 -0.078786851 -0.022090233</span></span>
<span><span class="co">#&gt; 6   2 -0.1372587389 0.03337233 -0.201713222 -0.075013670</span></span>
<span><span class="co">#&gt; 7   3 -0.1008113631 0.03113320 -0.161084551 -0.039208264</span></span></code></pre></div>
<p>Again the differences are in the standard errors, which are smaller
under the latter algorithm. But the substantive results are the
same.</p>
<p>Let’s now look at the overall post-treatment effect. Different
aggregations give different effects. Starting with the outputs of
<code>did</code>,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from group aggregation is"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from group aggregation is -0.031"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from dynamic aggregation is"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es</span><span class="op">$</span><span class="va">overall.att</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from dynamic aggregation is -0.077"</span></span></code></pre></div>
<p>For the outputs of <code>didwrappers</code>,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from group aggregation is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.att</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from group aggregation is -0.043"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from dynamic aggregation is"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.att</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from dynamic aggregation is -0.04"</span></span></code></pre></div>
<p>They are not the same, but are the same sign. The differences are in
the weighting, which is slightly different across the two algorithms and
even across the aggregation schemes.</p>
<p>For 95% confidence intervals, starting with the <code>did</code>
objects:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from group aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from group aggregation is [ -0.056 , -0.006 ]"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from dynamic aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from dynamic aggregation is [ -0.102 , -0.053 ]"</span></span></code></pre></div>
<p>Using the <code>didwrappers</code> object,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from group aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.lci</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.uci</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from group aggregation is [ -0.087 , 0 ]"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from dynamic aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.lci</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.uci</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from dynamic aggregation is [ -0.098 , 0.021 ]"</span></span></code></pre></div>
<p>The overall dynamic effects are not significant under the latter
algorithm, despite all of the component dynamic effects being so.</p>
<p>The results presented were for an unconditional
differences-in-difference. But unconditional results might be
misleading, because the treatment and control groups are too different.
In such cases, re-weighting the control units so that they look similar
is one way to proceed. This is the snippet that would implement a
weighting algorithm in the <code>did</code> package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_lpop</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/att_gt.html" class="external-link">att_gt</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"ipw"</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>The call in the <code>didwrappers</code> package is similar, but I am
going to suppress warnings because I expect some overlap violations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it_lpop</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"ipw"</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Even when the group-level algorithm doesn’t have overlap violations,
the unit-level algorithm does. The default setting is to remove the
violating units, but this can be changed by setting
<code>overlap = "retain"</code> in the initial <code>att_it</code> call.
The unit that the overlap violation occurred at has the lowest
population of all the counties in the sample. For such a violation to
occur at the group level, the counties treated at a time must have a
lower average population than all the untreated counties.</p>
<p>Whether aggregation should be at the group-level or the unit-level
should come down to the nature of the data. For example, if there are
many similar units, a group level algorithm is ideal for its speed and
statistical properties. If there are a few heterogeneous units, and only
few will have good comparisons, then a unit-level algorithm may do
better. Analysts may use the unit-level algorithm as a complement to
diagnose outliers that are obscured by a group-level algorithm.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ransi Clark.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
