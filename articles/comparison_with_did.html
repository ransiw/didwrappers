<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Comparison between did and didwrappers â€¢ didwrappers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparison between did and didwrappers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">didwrappers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison_with_did.html">Comparison between did and didwrappers</a></li>
    <li><a class="dropdown-item" href="../articles/minimum-wage.html">Minimum wage example</a></li>
    <li><a class="dropdown-item" href="../articles/my-article.html">Democratization on growth</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ransiw/didwrappers/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Comparison between did and didwrappers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ransiw/didwrappers/blob/main/vignettes/comparison_with_did.Rmd" class="external-link"><code>vignettes/comparison_with_did.Rmd</code></a></small>
      <div class="d-none name"><code>comparison_with_did.Rmd</code></div>
    </div>

    
    
<p>This vignette compares the <code>did</code> and the current package
using the example data in the <code>did</code> package,
<code>mpdta</code>.</p>
<p>The example dataset that is used here contain county-level teen
employment (<code>lemp</code>) for years 2003-2007. The treatment is
minimum wage. The <code>first.treat</code> variable in the data encodes
the year the county raised minimum wage over the federally-mandated
level.</p>
<p>This vignette should be read along with the linked <a href="https://bcallaway11.github.io/did/" class="external-link">article</a> by Brantly
Callaway. I recreate the main results that were produced by the
<code>did</code> package, and then follow up with the comparable results
of <code>didwrappers</code>. The differences between the packages will
become clear soon.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ransiw/didwrappers" class="external-link">didwrappers</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcallaway11.github.io/did/" class="external-link">did</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span></code></pre></div>
<p>The first step in the <code>did</code> algorithm is to produce the
group-time component differences-in-differences estimates. I also time
the run times.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/att_gt.html" class="external-link">att_gt</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"reg"</span></span>
<span>              <span class="op">)</span></span>
<span><span class="va">endt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Time elapsed:"</span>,<span class="va">endt</span><span class="op">-</span><span class="va">startt</span>,<span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time elapsed: 0.844208240509033 seconds"</span></span></code></pre></div>
<p>The <code>didwrappers</code> package produces a similar object but at
the more granular unit-time level. This takes longer to run. The syntax
remains the same, only the function name should need to change.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"reg"</span></span>
<span>              <span class="op">)</span></span>
<span><span class="va">endt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Time elapsed:"</span>,<span class="va">endt</span><span class="op">-</span><span class="va">startt</span>,<span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Time elapsed: 8.0568573474884 seconds"</span></span></code></pre></div>
<p>It takes quite a bit longer to do things at the county-level than at
the group level, which is the year that minimum wage is raised. There
are certain advantages to having the more disaggregate county-level
object that <code>didwrappers:att_it</code> produces, particularly, if
aggregation across other attributes are needed.</p>
<p>The <code>didwrappers</code> package has a function to view this data
as a data frame. It is similar to <code>summary</code> functionality in
<code>did</code>, but handier if you wish to export the object as a
data-frame than a list. Here are the first 5 records of the table.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/attit_table.html">attit_table</a></span><span class="op">(</span><span class="va">out_it</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;      id group    t         att          se</span></span>
<span><span class="co">#&gt; 1 17005  2004 2004 -0.05585158 0.009708404</span></span>
<span><span class="co">#&gt; 2 17005  2004 2005 -0.20309028 0.010035359</span></span>
<span><span class="co">#&gt; 3 17005  2004 2006 -0.28130294 0.013757545</span></span>
<span><span class="co">#&gt; 4 17005  2004 2007 -0.20345574 0.014189160</span></span>
<span><span class="co">#&gt; 5 17015  2004 2004  0.05381939 0.009708404</span></span></code></pre></div>
<p>Now these can be aggregated at the group level, dynamic level,
calendar-time level. Starting with the object produced by the call to
the <code>did:att_gt</code> function, letâ€™s take the group average.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_effects</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/aggte.html" class="external-link">aggte</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>didwrappers</code> package has a handy function to view
these as a data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">)</span></span>
<span><span class="co">#&gt;    egt     att.egt     se.egt       lowci      highci</span></span>
<span><span class="co">#&gt; 1 2004 -0.07974913 0.02881168 -0.14673404 -0.01276422</span></span>
<span><span class="co">#&gt; 2 2006 -0.02290954 0.01580673 -0.05965895  0.01383987</span></span>
<span><span class="co">#&gt; 3 2007 -0.02605441 0.01669651 -0.06487250  0.01276368</span></span></code></pre></div>
<p>Now, to trying this with the unit-time object. The syntax is quite
similar, and these aggregation functions are not so computationally
expensive to run, even with a larger object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_effects_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">)</span></span>
<span><span class="co">#&gt;    egt     att.egt      se.egt       lowci        highci</span></span>
<span><span class="co">#&gt; 1 2004 -0.07974913 0.010317217 -0.10248598 -0.0570122682</span></span>
<span><span class="co">#&gt; 2 2006 -0.02290954 0.010679314 -0.04644438  0.0006252994</span></span>
<span><span class="co">#&gt; 3 2007 -0.02605441 0.009325557 -0.04660587 -0.0055029527</span></span></code></pre></div>
<p>The estimates produced by these packages are the same. The
differences are in the standard errors, even though they both use
simultaneous confidence intervals. The effect for year 2007 is now
significant at the 5% level. This isnâ€™t necessarily good or bad. As you
will see, <code>didwrappers:aggite</code> standard errors are not always
smaller than the <code><a href="https://bcallaway11.github.io/did/reference/aggte.html" class="external-link">did::aggte</a></code> standard errors.</p>
<p>One more aggregation method before the end of this vignette. Going
back to the group-time object,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/aggte.html" class="external-link">aggte</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"dynamic"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">es</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt       att.egt     se.egt        lowci       highci</span></span>
<span><span class="co">#&gt; 1  -3  0.0305066556 0.01520449 -0.007059108  0.068072419</span></span>
<span><span class="co">#&gt; 2  -2 -0.0005630846 0.01296547 -0.032596908  0.031470739</span></span>
<span><span class="co">#&gt; 3  -1 -0.0244587450 0.01380419 -0.058564795  0.009647305</span></span>
<span><span class="co">#&gt; 4   0 -0.0199318168 0.01215707 -0.049968314  0.010104681</span></span>
<span><span class="co">#&gt; 5   1 -0.0509573671 0.01692481 -0.092773537 -0.009141197</span></span>
<span><span class="co">#&gt; 6   2 -0.1372587389 0.03730201 -0.229420903 -0.045096575</span></span>
<span><span class="co">#&gt; 7   3 -0.1008113631 0.03660616 -0.191254293 -0.010368434</span></span></code></pre></div>
<p>With the unit-time level algorithm,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type <span class="op">=</span> <span class="st">"dynamic"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt       att.egt     se.egt        lowci      highci</span></span>
<span><span class="co">#&gt; 1  -3  0.0305066556 0.01019785  0.004537753  0.05647556</span></span>
<span><span class="co">#&gt; 2  -2 -0.0005630846 0.02283701 -0.058717685  0.05759152</span></span>
<span><span class="co">#&gt; 3  -1 -0.0244587450 0.06819101 -0.198107620  0.14919013</span></span>
<span><span class="co">#&gt; 4   0 -0.0199318168 0.05078768 -0.149262986  0.10939935</span></span>
<span><span class="co">#&gt; 5   1 -0.0509573671 0.04813042 -0.173521809  0.07160707</span></span>
<span><span class="co">#&gt; 6   2 -0.1372587389 0.01463517 -0.174527288 -0.09999019</span></span>
<span><span class="co">#&gt; 7   3 -0.1008113631 0.01466721 -0.138161520 -0.06346121</span></span></code></pre></div>
<p>The standard errors for time lag 1 are larger here than with the
<code>did</code> package. If you are curious, you can go look in the
object produced by <code>attit</code> to see which unit might be causing
this. I do a bit more sleuthing in a different vignette.</p>
<p>Letâ€™s now look at the overall post-treatment effect. Different
aggregations give different effects. Starting with the outputs of
<code>did</code>,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from group aggregation is"</span>,<span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from group aggregation is -0.031018282228749"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from dynamic aggregation is"</span>,<span class="va">es</span><span class="op">$</span><span class="va">overall.att</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from dynamic aggregation is -0.0772398214573161"</span></span></code></pre></div>
<p>For the outputs of <code>didwrappers</code>,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from group aggregation is"</span>,<span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from group aggregation is -0.031018282228749"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Overall effect from dynamic aggregation is"</span>,<span class="va">es_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Overall effect from dynamic aggregation is -0.0772398214573161"</span></span></code></pre></div>
<p>They are the same here. This is not surprising because the mid-level
aggregations were also the same.</p>
<p>For 95% confidence intervals, starting with the <code>did</code>
objects:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from group aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from group aggregation is [ -0.055 , -0.007 ]"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from dynamic aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from dynamic aggregation is [ -0.102 , -0.053 ]"</span></span></code></pre></div>
<p>Using the <code>didwrappers</code> object,</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from group aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">group_effects_it</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from group aggregation is [ -0.045 , -0.017 ]"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"CI for overall effect from dynamic aggregation is"</span>,<span class="st">"["</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">","</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.att</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="va">es_it</span><span class="op">$</span><span class="va">overall.se</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CI for overall effect from dynamic aggregation is [ -0.121 , -0.033 ]"</span></span></code></pre></div>
<p>The results presented were for an unconditional
differences-in-difference. But unconditional results might be
misleading, because the treatment and control groups are too different.
In such cases, re-weighting the control units so that they look similar
is one way to proceed. This is the snippet that would implement a
weighting algorithm in the <code>did</code> package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_lpop</span> <span class="op">&lt;-</span> <span class="fu">did</span><span class="fu">::</span><span class="fu"><a href="https://bcallaway11.github.io/did/reference/att_gt.html" class="external-link">att_gt</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"ipw"</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>The call in the <code>didwrappers</code> package is similar, but I am
going to suppress warnings because I expect some overlap violations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it_lpop</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"ipw"</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Even when the group-level algorithm doesnâ€™t have overlap violations,
the unit-level algorithm does. The default setting is to remove the
violating units, but this can be changed by setting
<code>overlap = "retain"</code> in the initial <code>att_it</code> call.
The unit that the overlap violation occurred at has the lowest
population of all the counties in the sample. For such a violation to
occur at the group level, the counties treated at a time must have a
lower average population than all the untreated counties.</p>
<p>Whether aggregation should be at the group-level or the unit-level
should come down to the nature of the data. If there are many units, and
there is reason to think there is not much heterogeneity within the
group, the group level algorithm is ideal. If there are a few units,
such as with cross-country studies, or the units that get treated at the
same time are sufficiently different, the unit-level algorithm is
better.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ransi Clark.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
