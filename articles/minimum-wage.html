<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Minimum wage example • didwrappers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Minimum wage example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">didwrappers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison_with_did.html">Comparison between did and didwrappers</a></li>
    <li><a class="dropdown-item" href="../articles/minimum-wage.html">Minimum wage example</a></li>
    <li><a class="dropdown-item" href="../articles/my-article.html">Democratization on growth</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ransiw/didwrappers/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Minimum wage example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ransiw/didwrappers/blob/main/vignettes/minimum-wage.Rmd" class="external-link"><code>vignettes/minimum-wage.Rmd</code></a></small>
      <div class="d-none name"><code>minimum-wage.Rmd</code></div>
    </div>

    
    
<p>This vignette goes through some of the main functions of the
<code>didwrappers</code> package using the example data in the
<code>did</code> package. Another vignette compares these two packages
for the same data. Use <code>browseVignettes("didwrappers")</code> to
access that, and other vignettes. I also recommend Brantly Callaway’s <a href="https://bcallaway11.github.io/did/" class="external-link">article</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ransiw/didwrappers" class="external-link">didwrappers</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">)</span></span></code></pre></div>
<p>The data consists of the minimal number of elements required for the
algorithm. The outcome variable of log of teen employment
<code>lemp</code>, the time (numeric) that the county first raised
minimum wage <code>first.treat</code>, the numeric identifier for the
county or unit <code>countyreal</code>, and the <code>year</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpdta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;     year countyreal     lpop     lemp first.treat treat</span></span>
<span><span class="co">#&gt; 866 2003       8001 5.896761 8.461469        2007     1</span></span>
<span><span class="co">#&gt; 841 2004       8001 5.896761 8.336870        2007     1</span></span>
<span><span class="co">#&gt; 842 2005       8001 5.896761 8.340217        2007     1</span></span>
<span><span class="co">#&gt; 819 2006       8001 5.896761 8.378161        2007     1</span></span></code></pre></div>
<p>The first step is to calculate every unit-time
difference-in-difference object. This code snippet does that.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Then these could be aggregated to give an overall post-treatment
effect. A simple aggregation could be done as follows,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple</span> <span class="op">=</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type<span class="op">=</span><span class="st">"simple"</span><span class="op">)</span></span>
<span><span class="va">simple</span><span class="op">$</span><span class="va">overall.att</span></span>
<span><span class="co">#&gt; [1] -0.03995128</span></span>
<span><span class="va">simple</span><span class="op">$</span><span class="va">overall.se</span></span>
<span><span class="co">#&gt; [1] 0.0894012</span></span></code></pre></div>
<p>But there is more that can be done. Perhaps, we want to see the
effect of raising minimum wage for all counties that raised the minimum
wage in 2004, or 2007.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group</span> <span class="op">=</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type<span class="op">=</span><span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<p>A further function can be useful to unravel the list object into a
data-frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="co">#&gt;    egt     att.egt      se.egt       lowci       highci</span></span>
<span><span class="co">#&gt; 1 2004 -0.07974913 0.010902835 -0.10604442 -0.053453831</span></span>
<span><span class="co">#&gt; 2 2006 -0.02290954 0.010659896 -0.04861892  0.002799840</span></span>
<span><span class="co">#&gt; 3 2007 -0.02605441 0.009223667 -0.04829992 -0.003808906</span></span></code></pre></div>
<p>This shows that on average counties that raised minimum wage in 2004,
and 2007 saw a statistically significant (at 95%) drop in teen
employment. For 2006, the effect was negative, but not statistically
significant.</p>
<p>One concern with this type of aggregation is that the counties that
raised minimum wage in 2004 have more post-treatment observations than
counties that raise minimum wage later. If raising the minimum wage has
different dynamic effects, we want to be able to see that. To do that,
we could cut the unit-time object <code>out_it</code> a different way:
at the dynamic level.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dynamic</span> <span class="op">=</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it</span>, type<span class="op">=</span><span class="st">"dynamic"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">dynamic</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt       att.egt      se.egt        lowci      highci</span></span>
<span><span class="co">#&gt; 1  -3  0.0305066556 0.009704581  0.006247595  0.05476572</span></span>
<span><span class="co">#&gt; 2  -2 -0.0005630846 0.022983661 -0.058016571  0.05689040</span></span>
<span><span class="co">#&gt; 3  -1 -0.0244587450 0.065387848 -0.187912246  0.13899476</span></span>
<span><span class="co">#&gt; 4   0 -0.0199318168 0.052064514 -0.150080267  0.11021663</span></span>
<span><span class="co">#&gt; 5   1 -0.0509573671 0.050115513 -0.176233795  0.07431906</span></span>
<span><span class="co">#&gt; 6   2 -0.1372587389 0.014923562 -0.174563966 -0.09995351</span></span>
<span><span class="co">#&gt; 7   3 -0.1008113631 0.014527170 -0.137125706 -0.06449702</span></span></code></pre></div>
<p>It also gives us placebo trends.</p>
<p>We can also retrieve the overall effect and standard error from this
same object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dynamic</span><span class="op">$</span><span class="va">overall.att</span></span>
<span><span class="co">#&gt; [1] -0.07723982</span></span>
<span><span class="va">dynamic</span><span class="op">$</span><span class="va">overall.se</span></span>
<span><span class="co">#&gt; [1] 0.02368082</span></span></code></pre></div>
<p>Until now we have run unconditional differences-in-differences. But,
it might not be appropriate to compare counties of very different
population. There are a variety of reweighting algorithms (same as those
in the <code>did</code> package) that can help. I’ll demonstrate with
inverse-propensity score weighting. I suppress the warning messages that
come when the overlap condition is violated, but we’ll quickly see how
to figure out the ones that are the problem.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it_lpop</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              xformla <span class="op">=</span> <span class="op">~</span><span class="va">lpop</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span>,</span>
<span>              est_method <span class="op">=</span> <span class="st">"ipw"</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Save this into a table, and look at the units for which the overlap
condition failed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it_lpop_tbl</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/attit_table.html">attit_table</a></span><span class="op">(</span><span class="va">out_it_lpop</span><span class="op">)</span></span>
<span><span class="va">out_it_lpop_tbl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">out_it_lpop_tbl</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span></span>
<span><span class="co">#&gt;        id group    t att se     attcalc   ipwqual</span></span>
<span><span class="co">#&gt; 533 30109  2007 2004  NA NA -0.06899286 0.9999998</span></span>
<span><span class="co">#&gt; 534 30109  2007 2005  NA NA -0.20342179 0.9999998</span></span>
<span><span class="co">#&gt; 535 30109  2007 2006  NA NA  0.31365748 0.9999998</span></span>
<span><span class="co">#&gt; 536 30109  2007 2007  NA NA -0.12825429 0.9999998</span></span></code></pre></div>
<p>For one of the counties, overlap failed. As shown by the
<code>ipwqual</code> field, which is very close to 1, the maximum
propensity score being that close to 1 shows that almost all the weight
lands on just one control unit. This can make standard errors inflate.
If you want to see what would happen anyway set the option
<code>overlap="retain"</code> in the initial <code>att_it</code>
call.</p>
<p>The rest of the steps can continue as above. For a quick comparison
to the dynamic effects, run the following snippet. Because the overlap
problems create issues for the standard errors, we should drop
these.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dynamic_lpop</span> <span class="op">=</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it_lpop</span>, type<span class="op">=</span><span class="st">"dynamic"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">dynamic_lpop</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt      att.egt      se.egt        lowci      highci</span></span>
<span><span class="co">#&gt; 1  -3  0.032511175 0.010561021  0.005546073  0.05947628</span></span>
<span><span class="co">#&gt; 2  -2  0.005318137 0.006090907 -0.010233573  0.02086985</span></span>
<span><span class="co">#&gt; 3  -1 -0.019057937 0.048749688 -0.143528891  0.10541302</span></span>
<span><span class="co">#&gt; 4   0 -0.021177277 0.072016727 -0.205055185  0.16270063</span></span>
<span><span class="co">#&gt; 5   1 -0.049562824 0.039816097 -0.151223938  0.05209829</span></span>
<span><span class="co">#&gt; 6   2 -0.129581200 0.017360619 -0.173907489 -0.08525491</span></span>
<span><span class="co">#&gt; 7   3 -0.095242090 0.015650096 -0.135200958 -0.05528322</span></span></code></pre></div>
<p>The estimates are a little different from the unconditional version.
But the substantive conclusions made would remain the same.</p>
<p>Another option with the <code>didwrappers</code> package is that you
can also choose an aggregation level based on a different variable. I’ll
create such a variable out of the <code>lpop</code> variable.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpdta</span><span class="op">$</span><span class="va">lpop2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">$</span><span class="va">lpop</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mpdta</span><span class="op">[</span><span class="va">mpdta</span><span class="op">$</span><span class="va">first.treat</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="st">"lpop2"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1   2   3   4   5   6   7 </span></span>
<span><span class="co">#&gt;  15  10 165 315 260 120  55  15</span></span></code></pre></div>
<p>There are 8 population categories in the treatment set, but the
category 0, 1, and 7 have 3 or less units. If we want to aggregate to
these new population categories, we can go to the <code>att_it</code>
function’s <code>cohortnames</code> option. I’ll do it as an
unconditional difference-in-difference, but you can do a conditional one
with the <code>xformla</code> option.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_it_cohort</span> <span class="op">&lt;-</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/att_it.html">att_it</a></span><span class="op">(</span>yname <span class="op">=</span> <span class="st">"lemp"</span>,</span>
<span>              gname <span class="op">=</span> <span class="st">"first.treat"</span>,</span>
<span>              idname <span class="op">=</span> <span class="st">"countyreal"</span>,</span>
<span>              tname <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>              cohortnames <span class="op">=</span> <span class="st">"lpop2"</span>,</span>
<span>              data <span class="op">=</span> <span class="va">mpdta</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>Aggregating by population level,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort</span> <span class="op">=</span> <span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite.html">aggite</a></span><span class="op">(</span><span class="va">out_it_cohort</span>, type<span class="op">=</span><span class="st">"lpop2"</span><span class="op">)</span></span>
<span><span class="fu">didwrappers</span><span class="fu">::</span><span class="fu"><a href="../reference/aggite_table.html">aggite_table</a></span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt;   egt      att.egt      se.egt        lowci       highci</span></span>
<span><span class="co">#&gt; 1   0  0.076447182 0.009735988  0.054446542  0.098447822</span></span>
<span><span class="co">#&gt; 2   1  0.539728790 0.009100836  0.519163417  0.560294163</span></span>
<span><span class="co">#&gt; 3   2 -0.096677840 0.006506535 -0.111380810 -0.081974870</span></span>
<span><span class="co">#&gt; 4   3 -0.052241580 0.006573998 -0.067096997 -0.037386162</span></span>
<span><span class="co">#&gt; 5   4 -0.030810515 0.006645442 -0.045827375 -0.015793654</span></span>
<span><span class="co">#&gt; 6   5 -0.017876462 0.006462027 -0.032478855 -0.003274069</span></span>
<span><span class="co">#&gt; 7   6 -0.002419735 0.006906881 -0.018027375  0.013187905</span></span>
<span><span class="co">#&gt; 8   7  0.021283644 0.006793726  0.005931703  0.036635586</span></span></code></pre></div>
<p>The effect is positive for the populations in bucket 0, 1, and 7, but
these are also the same ones that we didn’t have enough treatment units
of. So, they may not be representative of those population levels.</p>
<p>But even with 11 treatment units, the effect for population bucket 6
is very close to zero. In this sample, minimum wage increases affects
the mid-population counties more than the high population counties.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ransi Clark.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
